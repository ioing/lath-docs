"use strict";(self.webpackChunklath_exp_1=self.webpackChunklath_exp_1||[]).push([[960],{960:(e,t,i)=>{i.r(t),i.d(t,{AppSwitcher:()=>y});var n,s,r=i(690),a=i(196);n=(e,t=!1)=>(0,r._)(void 0,void 0,void 0,(function*(){var i;null!=(i=e.getAnimations)&&i.call(e,{subtree:t}).forEach((e=>{e.finish(),e.cancel()}))})),s=e=>{var t;const i=[];return null!=(t=e.getAnimations)&&t.call(e).forEach((e=>{i.push(e.finished)})),Promise.all(i)};const o="\n  display: grid;\n  box-sizing: border-box;\n  position: fixed;\n  inset: 0;\n  z-index: 2;\n  width: 100%;\n  height: 100%;\n  padding: 20px 10px;\n  padding-top: calc(20px + constant(safe-area-inset-top));\n  padding-top: calc(20px + env(safe-area-inset-top));\n  scroll-padding-top: calc(20px + constant(safe-area-inset-top));\n  scroll-padding-top: calc(20px + env(safe-area-inset-top));\n  overflow-y: hidden;\n  scroll-behavior: smooth;\n  transform: translate3d(0, 0, 0);\n  backface-visibility: hidden;\n",l=`\n  ${o}\n  grid-template-columns: 50% 50%;\n  grid-template-rows: repeat(30, 40%);\n  row-gap: 15px;\n`,p=`\n  ${o}\n  grid-template-columns: repeat(3, 33.33%);\n  grid-template-rows: repeat(30, 50%);\n  row-gap: 15px;\n`,d="\n  display: block;\n  width: 100%;\n  height: 100%;\n  border-radius: 16px;\n  transform-origin: top left;\n  transform: translate3d(0, 0, 0);\n  backface-visibility: hidden;\n  overflow: hidden;\n",c=`\n  position: fixed;\n  top: 0;\n  left: 0;\n  ${d}\n`,h="\n  position: absolute;\n  height: 2px;\n  width: 60%;\n  background: #fff;\n  border-radius: 1px;\n",f=`\n  ${h}\n  transform: rotate(-45deg);\n`,u=`\n  ${h}\n  transform: rotate(45deg);\n`,m="cubic-bezier(0.52, 0.16, 0.24, 1)",g="cubic-bezier(0.32, 0.08, 0.24, 1)",v=CSS.supports("backdrop-filter","blur(1px)");class y{constructor(e){this.progressName="",this.deleteMap={},this.options={readonly:!1};var{relativeViewport:t,absoluteViewport:i,fixedViewport:n}=e.segue;this.relativeViewport=t,this.absoluteViewport=i,this.fixedViewport=n,this.application=e,this.delayDynamicImport()}bindResize(){const e=()=>{this.close(),window.removeEventListener("resize",e),window.removeEventListener("orientationchange",e)};window.addEventListener("resize",e),window.addEventListener("orientationchange",e)}open(e){return(0,r._)(this,void 0,void 0,(function*(){"open"!==this.progressName&&(this.progressName="open",e&&(this.options=e),yield(0,a.l)(),yield this.createAppSwitcher(),v||(yield this.blurBackgroundImage()),this.switcher.style.opacity="1",this.bindResize(),(0,a.s)((()=>{"close"!==this.progressName&&(this.progressName="")}),400))}))}close(){return(0,r._)(this,void 0,void 0,(function*(){"close"!==this.progressName&&(this.progressName="close",v||(yield this.focusBackgroundImage()),this.switcher.style.opacity="0",(0,a.s)((()=>{"open"!==this.progressName&&(this.progressName="",this.switcher.parentElement===this.fixedViewport)&&this.fixedViewport.removeChild(this.switcher)}),400))}))}createAppSwitcher(){var e;return(0,r._)(this,void 0,void 0,(function*(){this.switcher=document.createElement("applet-switcher"),this.switcher.style.cssText="\n  box-sizing: border-box;\n  position: fixed;\n  inset: 0;\n  z-index: 102;\n  width: 100%;\n  height: 100%;\n  background: rgb(70 70 70 / 50%);\n  opacity: 0;\n  transform: translate3d(0, 0, 0);\n  backface-visibility: hidden;\n  transition: opacity .4s ease;\n  backdrop-filter: blur(20px) saturate(180%);\n",this.snapWrapper=document.createElement("applet-switcher-snap"),this.snapWrapper.style.cssText=800<this.switcher.offsetWidth?p:l,this.scroll=new a.S(this.snapWrapper);var t=this.application.applets,i=this.getActiveApplet(),n=null==(e=null==i?void 0:i.parentApplet)?void 0:e.allSubAppletIds;for(const e in t){const l=t[e];var s=l.color,r=null==n?void 0:n.includes(e);if(this.deleteMap[l.id]!==l.createTime&&"applet"===l.rel&&!l.isModality&&!l.slide&&l.view){const e=document.createElement("applet-switcher-item"),t=document.createElement("div"),n=document.createElement("div");var o=document.createElement("div"),c=document.createElement("div"),h=document.createElement("div"),m=(e.style.cssText="\n  display: flex;\n  flex-direction: column;\n  box-sizing: border-box;\n  scroll-snap-align: start;\n  cursor: pointer;\n  margin: 0 10px;\n  transition: transform .4s ease;\n",l.config.poster?`\n          background-image: url(${l.config.poster});\n          background-size: cover;\n        `:"");if(t.style.cssText=`\n          \n  display: block;\n  position: relative;\n  width: 100%;\n  height: 100%;\n  border-radius: 16px;\n  overflow: hidden;\n  box-shadow: 0 3px 10px rgb(0 0 0 / 30%);\n\n          background: ${s};\n          ${m}\n        `,n.style.cssText=`\n          ${d}\n          background: ${s};\n        `,c.style.cssText="\n  display: flex;\n  margin: 0 auto;\n  width: 100%;\n  justify-content: center;\n  align-items: center;\n",o.style.cssText=l.config.icon?`\n          width: 16px;\n          height: 16px;\n          background-image: url(${l.config.icon});\n        `:"display: none;",h.style.cssText='\n  margin-top: 4px;\n  font-size: 16px;\n  color: #fff;\n  overflow: hidden;\n  white-space: nowrap;\n  text-overflow: ellipsis;\n  font-family: "SF Pro Text","Myriad Set Pro","SF Pro Icons","Apple Legacy Chevron","Helvetica","Arial",sans-serif;\n',h.innerText=l.config.title||l.id,c.appendChild(o),c.appendChild(h),t.appendChild(n),e.appendChild(t),e.appendChild(c),this.snapWrapper.appendChild(e),this.switcher.appendChild(this.snapWrapper),this.fixedViewport.appendChild(this.switcher),l.id===(null==i?void 0:i.id))yield this.setActivityItem(l,t,n);else{this.options.readonly||r||!0===l.config.background||l.isPresetAppletsView||(m=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),m.style.cssText="\n  display: grid;\n  place-items: center;\n  position: absolute;\n  right: 4px;\n  top: 4px;\n  width: 22px;\n  height: 22px;\n  border-radius: 11px;\n  background-color: #666;\n  opacity: .7\n",s.style.cssText=f,o.style.cssText=u,m.appendChild(s),m.appendChild(o),t.appendChild(m),m.addEventListener("click",(()=>{var t;if(l.parentApplet){for(const e of l.parentApplet.allSubAppletIds)null!=(t=this.application.applets[e])&&t.destroy();l.parentApplet.destroy()}else l.destroy();this.deleteItem(e),this.deleteMap[l.id]=l.createTime}),!1));const i=()=>{(0,a.r)((()=>{this.setNormalItem(l,n)}))},p=new IntersectionObserver((function(e){e[0].intersectionRatio<0||(p.unobserve(t),i())}));p.observe(t)}this.bindItemClick(l,t,n)}}}))}deleteItem(e){var t=[],i=Array.from(this.snapWrapper.children),n=i.indexOf(e),s=i.slice(n).filter((e=>!e.getAttribute("applet-to-delete")));for(let e=1;e<=s.length-1;e++){var r=s[e-1],a=s[e];r=r.getBoundingClientRect(),t.push({x:r.x-a.offsetLeft,y:r.y-a.offsetTop})}e.setAttribute("applet-to-delete","true"),e.style.transform="translate3d(-100vw, 0, 0)";for(let e=1;e<=s.length-1;e++){var o=s[e],l=t[e-1];o.style.transform=`translate3d(${l.x}px, ${l.y}px, 0)`}}bindItemClick(e,t,i){i.addEventListener("click",(()=>{"close"!==this.progressName&&(this.progressName="close",this.restoreToItem(e,t,i))}))}setNormalItem(e,t){return(0,r._)(this,void 0,void 0,(function*(){e.captureShot(12e4<=Date.now()-e.visitTime).then((e=>(0,r._)(this,void 0,void 0,(function*(){t.appendChild(e),yield e.animate([{opacity:0},{opacity:.1}],{duration:0,easing:m,fill:"forwards"}).finished,e.animate([{opacity:.1},{opacity:1}],{duration:300,easing:m,fill:"forwards"}).play()})))).catch((e=>{console.warn(e)}))}))}setActivityItem(e,t,i){return(0,r._)(this,void 0,void 0,(function*(){var s=e.color;const o=t.offsetWidth/this.switcher.offsetWidth,l=i.style.cssText,p=t.offsetHeight,d=t.offsetTop,h=t.offsetLeft;i.style.cssText=`\n      ${c}\n      z-index: 3;\n      background: ${s};\n      border-radius: ${16/o}px;\n    `,this.switcher.appendChild(i),i.appendChild(yield e.captureShot()),"close"!==this.progressName&&(yield i.animate([{opacity:0},{opacity:1}],{duration:100,easing:m,fill:"forwards"}).finished,this.snapWrapper.animate({transform:"translate3d(0, 0, 0) scale(.9)",opacity:.5},{duration:0,fill:"forwards"}).finished.then((()=>(0,r._)(this,void 0,void 0,(function*(){yield Promise.all([i.animate({height:p/o+"px"},{duration:460,easing:m,fill:"forwards"}).finished,i.animate({transform:`translate3d(${h}px, ${d}px, 0) scale(${o})`},{duration:360,easing:g,fill:"forwards"}).finished,this.snapWrapper.animate({transform:"translate3d(0, 0, 0) scale(1)"},{duration:440,easing:m,fill:"forwards"}).finished,this.snapWrapper.animate({opacity:1},{duration:360,easing:m,fill:"forwards"}).finished]),"close"!==this.progressName&&(i.style.cssText=l,n(i),n(t),t.appendChild(i),this.snapWrapper.style.overflowY="scroll",this.snapWrapper.style.scrollSnapType="y mandatory",this.snapWrapper.offsetHeight<=d)&&(0,a.r)((()=>{this.scroll.snapTo(0,d)}))})))))}))}restoreToItem(e,t,i){return(0,r._)(this,void 0,void 0,(function*(){var n=t.offsetTop,s=t.offsetLeft,r=t.offsetWidth,o=t.offsetHeight,l=(r/=this.switcher.offsetWidth,e.color);this.switcher.appendChild(i),i.style.cssText=`\n      ${c}\n      z-index: 5;\n      height: ${o/r}px;\n      background: ${l};\n      border-radius: ${16/r}px;\n      transform: translate3d(${s}px, ${n}px, 0px) scale(${r});\n    `,"open"!==this.progressName&&(v||this.application.segue.resetBaseStyle("filter: blur(20px);"),yield Promise.all([this.application.to(e.id,e.param,void 0,void 0,!0),i.animate({transform:"translate3d(0, 0, 0) scale(1)"},{duration:400,easing:g,fill:"forwards"}).finished,i.animate({height:this.switcher.offsetHeight+"px"},{duration:100,easing:m,fill:"forwards"}).finished,i.animate({borderRadius:"0px"},{duration:800,easing:m,fill:"forwards"}).finished,this.snapWrapper.animate({transform:"translate3d(0, 0, 0) scale(.9)"},{duration:440,easing:m,fill:"forwards"}).finished,this.snapWrapper.animate({opacity:.5},{duration:200,easing:m,fill:"forwards"}).finished]),v||(this.application.segue.resetBaseStyle(),this.application.segue.appletGroup.forEach((e=>{e.viewport&&(e.viewport.style.filter="none",(0,a.a)(e.viewport))}))),this.progressName="",this.close())}))}getActiveApplet(){var e=this.application.activityApplet;return null!=e&&e.slide?e.subApplet:e}blurBackgroundImage(e=!0){return(0,r._)(this,void 0,void 0,(function*(){yield s(this.relativeViewport),yield s(this.absoluteViewport),this.relativeViewport.style.filter=this.absoluteViewport.style.filter=e?"blur(20px)":"none",yield(0,a.a)(this.relativeViewport),yield(0,a.a)(this.absoluteViewport)}))}focusBackgroundImage(){return(0,r._)(this,void 0,void 0,(function*(){yield this.blurBackgroundImage(!1)}))}delayDynamicImport(){Promise.all([i.e(715),i.e(58)]).then(i.bind(i,58)).catch((e=>{console.warn(e)}))}}}}]);